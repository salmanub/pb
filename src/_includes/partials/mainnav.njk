<header id="mainHeader" class="main-header">
    <div class="container">
        <!-- Top Bar - Solo visible en desktop -->
        <div class="top-bar">
            <!-- Language Selector -->
            <div class="language-selector">
                {Object.entries(languages).map(([code, name]) => (
                    <a href={code === 'es' ? '/' : `/${code}`} class="language-link">
                        {code}
                    </a>
                ))}
            </div>
            <!-- CTAs con traducciones -->
            <div class="top-cta">
                <a href={`tel:${{phoneNumber}}`} class="phone-link">
                    <span class="phone-icon"></span>
                    <span>{{metadata.contact.phoneNumber}}</span>
                </a>
                <a href="/presupuesto" class="cta-button top-cta-button">
                    {t('nav.budget')}
                </a>
            </div>
        </div>

        <!-- Main Bar -->
        <div class="header-content">
            <!-- Logo -->
            <div class="logo">
                <a href="/" class="logo-link">
                    <svg
                        class="logo-svg"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 375 374.999991"
                        preserveAspectRatio="xMidYMid meet"
                    >
                        <defs>
                            <clipPath id="2717b77dc4">
                                <path
                                    d="M 223.109375 37.496094 L 314.597656 37.496094 L 314.597656 337.6875 L 223.109375 337.6875 Z M 223.109375 37.496094"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="9422b2d12e">
                                <path
                                    d="M 314.597656 67.992188 L 314.597656 337.496094 L 223.109375 307 L 223.109375 37.496094 Z M 314.597656 67.992188"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="b07c821656">
                                <path
                                    d="M 146.625 37.496094 L 223.117188 37.496094 L 223.117188 249.945312 L 146.625 249.945312 Z M 146.625 37.496094"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="55959a45ff">
                                <path
                                    d="M 146.625 62.996094 L 146.625 249.945312 L 223.117188 224.449219 L 223.117188 37.496094 Z M 146.625 62.996094"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="a83aa56b9b">
                                <path
                                    d="M 112.101562 111.523438 L 177.742188 111.523438 L 177.742188 291.515625 L 112.101562 291.515625 Z M 112.101562 111.523438"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="1c3af9afe2">
                                <path
                                    d="M 177.742188 133.402344 L 177.742188 291.402344 L 112.101562 269.523438 L 112.101562 111.523438 Z M 177.742188 133.402344"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="a2157cede2">
                                <path
                                    d="M 60.398438 111.367188 L 112.109375 111.367188 L 112.109375 237.410156 L 60.398438 237.410156 Z M 60.398438 111.367188"
                                    clip-rule="nonzero"
                                />
                            </clipPath>

                            <clipPath id="1adccc21aa">
                                <path
                                    d="M 60.398438 128.75 L 60.398438 237.410156 L 112.109375 220.175781 L 112.109375 111.515625 Z M 60.398438 128.75"
                                    clip-rule="nonzero"
                                />
                            </clipPath>
                        </defs>

                        <g clip-path="url(#2717b77dc4)">
                            <g clip-path="url(#9422b2d12e)">
                                <path
                                    fill="currentColor"
                                    d="M 314.597656 37.496094 L 314.597656 337.332031 L 223.109375 337.332031 L 223.109375 37.496094 Z M 314.597656 37.496094"
                                    fill-opacity="1"
                                    fill-rule="nonzero"
                                />
                            </g>
                        </g>

                        <g clip-path="url(#b07c821656)">
                            <g clip-path="url(#55959a45ff)">
                                <path
                                    fill="currentColor"
                                    d="M 146.625 249.945312 L 146.625 37.496094 L 223.117188 37.496094 L 223.117188 249.945312 Z M 146.625 249.945312"
                                    fill-opacity="1"
                                    fill-rule="nonzero"
                                />
                            </g>
                        </g>

                        <g clip-path="url(#a83aa56b9b)">
                            <g clip-path="url(#1c3af9afe2)">
                                <path
                                    fill="currentColor"
                                    d="M 177.742188 111.523438 L 177.742188 291.515625 L 112.101562 291.515625 L 112.101562 111.523438 Z M 177.742188 111.523438"
                                    fill-opacity="1"
                                    fill-rule="nonzero"
                                />
                            </g>
                        </g>

                        <g clip-path="url(#a2157cede2)">
                            <g clip-path="url(#1adccc21aa)">
                                <path
                                    fill="currentColor"
                                    d="M 60.398438 237.410156 L 60.398438 111.570312 L 112.109375 111.570312 L 112.109375 237.410156 Z M 60.398438 237.410156"
                                    fill-opacity="1"
                                    fill-rule="nonzero"
                                />
                            </g>
                        </g>
                    </svg>
                    <h1>Perito Barcelona</h1>
                </a>
            </div>

            <!-- Mobile CTA + Menu Button -->
            <div class="mobile-controls">
                <!-- CTA solo visible si hay espacio (breakpoint sm) -->
                <a href="/presupuesto" class="cta-button mobile-cta">
                    {t('nav.budget')}
                </a>
                
                <button class="menu-toggle" id="menuButton" aria-label="Toggle menu">
                    <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>

            <!-- Desktop Navigation -->
            <nav class="desktop-nav">
                <ul class="nav-list">
                    {mainMenu.map(item => (
                        <li class="nav-item">
                            <a href={item.path} class="nav-link">
                                <span class="nav-icon"></span>
                                <span>{item.name}</span>
                                {item.hasDropdown && <span class="dropdown-icon"></span>}
                            </a>
                            {item.hasDropdown && (
                                <div class="dropdown-menu">
                                    <div class="dropdown-content">
                                        {services.map(service => (
                                            <a href={`/servicios/${service.path}`} class="dropdown-item">
                                                <span class="service-icon"></span>
                                                <div class="service-info">
                                                    <span class="service-name">{service.name}</span>
                                                    <span class="service-description">{service.description}</span>
                                                </div>
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </li>
                    ))}
                </ul>
                
                <button class="cta-button">
                    Solicitar Peritaje
                </button>
            </nav>
        </div>
    </div>

    <!-- Mobile Menu (oculto por defecto) -->
    <div id="mobileMenu" class="mobile-menu">
        <div class="container mobile-menu-container">
            <nav class="mobile-nav">
                {mainMenu.map(item => (
                    <div class="mobile-nav-item">
                        <a href={item.path} class="mobile-nav-link">
                            <div class="mobile-nav-icon-wrapper">
                                <span class="mobile-nav-icon"></span>
                                <span>{item.name}</span>
                            </div>
                            {item.hasDropdown && (
                                <span class="mobile-dropdown-icon"></span>
                            )}
                        </a>
                        
                        {item.hasDropdown && (
                            <div class="mobile-dropdown">
                                {services.map(service => (
                                    <a href={`/servicios/${service.path}`} class="mobile-service-link">
                                        <span class="mobile-service-icon"></span>
                                        <span class="mobile-service-name">{service.name}</span>
                                    </a>
                                ))}
                            </div>
                        )}
                    </div>
                ))}
            </nav>
            
            <div class="mobile-footer">
                <a href={`tel:${phoneNumber}`} class="mobile-phone-link">
                    <span class="mobile-phone-icon"></span>
                    <span>{phoneNumber}</span>
                </a>
                
                <button class="cta-button mobile-cta-button">
                    {t('nav.budget')}
                </button>
                
                <div class="mobile-language-selector">
                    {Object.entries(languages).map(([code, name]) => (
                        <a href={code === 'es' ? '/' : `/${code}`} class="mobile-language-link">
                            {code}
                        </a>
                    ))}
                </div>
            </div>
        </div>
    </div>
</header>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const menuButton = document.getElementById('menuButton');
        const mobileMenu = document.getElementById('mobileMenu');
        
        if (menuButton && mobileMenu) {
            menuButton.addEventListener('click', function() {
                const isOpen = mobileMenu.classList.contains('mobile-menu-open');
                
                if (isOpen) {
                    mobileMenu.classList.remove('mobile-menu-open');
                    menuButton.setAttribute('aria-expanded', 'false');
                } else {
                    mobileMenu.classList.add('mobile-menu-open');
                    menuButton.setAttribute('aria-expanded', 'true');
                }
            });
        }
    });
</script>

<style>
    /* Estilos para integrar con index.njk */
    :root {
        --primary: #2048e6;
        --primary-dark: #1e3fc8;
        --secondary: #ffffff;
        --text: #333333;
        --light-bg: #f7f9fc;
        --accent: rgba(32, 72, 230, 0.1);
    }
    
    /* Header */
    .main-header {
        background-color: var(--secondary);
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        position: fixed;
        width: 100%;
        z-index: 100;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }
    
    /* Top Bar */
    .top-bar {
        display: none;
        height: 48px;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        justify-content: flex-end;
        align-items: center;
    }
    
    .language-selector {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 0 16px;
        border-left: 1px solid rgba(0,0,0,0.05);
    }
    
    .language-link {
        padding: 4px 12px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 500;
        color: #666;
        text-decoration: none;
        border-radius: 4px;
        transition: all 0.3s;
    }
    
    .language-link:hover {
        color: var(--primary);
        background-color: var(--accent);
    }
    
    .top-cta {
        display: flex;
        align-items: center;
        border-left: 1px solid rgba(0,0,0,0.05);
    }
    
    .phone-link {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        color: #666;
        text-decoration: none;
        font-size: 14px;
        border-right: 1px solid rgba(0,0,0,0.05);
        transition: color 0.3s;
    }
    
    .phone-link:hover {
        color: var(--primary);
    }
    
    .top-cta-button {
        padding: 8px 16px;
        font-size: 14px;
    }
    
    /* Header Content */
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        height: 64px;
    }
    
    /* Logo */
    .logo {
        display: flex;
        align-items: center;
    }
    
    .logo-link {
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }
    
    .logo-svg {
        height: 40px;
        width: auto;
        color: var(--primary);
    }
    
    .logo h1 {
        font-size: 22px;
        font-weight: 700;
        color: var(--primary);
    }
    
    /* Mobile Controls */
    .mobile-controls {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .mobile-cta {
        display: none;
        padding: 8px 16px;
        font-size: 14px;
        border-radius: 30px;
    }
    
    .menu-toggle {
        position: relative;
        z-index: 50;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        cursor: pointer;
        color: var(--primary);
    }
    
    .menu-icon {
        width: 24px;
        height: 24px;
    }
    
    /* Desktop Navigation */
    .desktop-nav {
        display: none;
        flex: 1;
        align-items: center;
        justify-content: flex-end;
    }
    
    .nav-list {
        display: flex;
        list-style: none;
        margin-right: 24px;
    }
    
    .nav-item {
        position: relative;
        margin-left: 32px;
    }
    
    .nav-link {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 0;
        font-size: 14px;
        font-weight: 500;
        color: var(--text);
        text-decoration: none;
        transition: color 0.3s;
    }
    
    .nav-link:hover {
        color: var(--primary);
    }
    
    .dropdown-icon {
        width: 16px;
        height: 16px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-size: contain;
        transition: transform 0.3s;
    }
    
    .nav-item:hover .dropdown-icon {
        transform: rotate(180deg);
    }
    
    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        width: 280px;
        margin-top: 16px;
        opacity: 0;
        transform: translateY(10px);
        pointer-events: none;
        transition: all 0.2s;
    }
    
    .nav-item:hover .dropdown-menu {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
    }
    
    .dropdown-content {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid rgba(0,0,0,0.05);
        overflow: hidden;
    }
    
    .dropdown-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        color: var(--text);
        text-decoration: none;
        transition: background-color 0.3s;
    }
    
    .dropdown-item:hover {
        background-color: var(--light-bg);
    }
    
    .service-icon {
        width: 20px;
        height: 20px;
        color: var(--primary);
        flex-shrink: 0;
    }
    
    .service-info {
        display: flex;
        flex-direction: column;
    }
    
    .service-name {
        font-weight: 500;
        color: #333;
    }
    
    .service-description {
        font-size: 14px;
        color: #666;
    }
    
    /* Mobile Menu */
    .mobile-menu {
        position: fixed;
        inset: 0;
        background-color: white;
        z-index: 40;
        transform: translateX(100%);
        transition: transform 0.3s;
    }
    
    .mobile-menu-open {
        transform: translateX(0);
    }
    
    .mobile-menu-container {
        padding-top: 90px;
        padding-bottom: 32px;
    }
    
    .mobile-nav {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
    
    .mobile-nav-link {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 18px;
        font-weight: 500;
        color: #333;
        border-bottom: 1px solid rgba(0,0,0,0.05);
        text-decoration: none;
    }
    
    .mobile-nav-icon-wrapper {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .mobile-nav-icon {
        width: 20px;
        height: 20px;
        color: var(--primary);
    }
    
    .mobile-dropdown-icon {
        width: 20px;
        height: 20px;
        color: #ccc;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
        background-size: contain;
    }
    
    .mobile-dropdown {
        margin-top: 12px;
        margin-left: 32px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .mobile-service-link {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 0;
        color: #333;
        text-decoration: none;
        transition: color 0.3s;
    }
    
    .mobile-service-link:hover {
        color: var(--primary);
    }
    
    .mobile-service-icon {
        width: 20px;
        height: 20px;
        color: var(--primary);
        flex-shrink: 0;
    }
    
    .mobile-service-name {
        font-weight: 500;
    }
    
    .mobile-footer {
        margin-top: 32px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .mobile-phone-link {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #666;
        text-decoration: none;
    }
    
    .mobile-phone-icon {
        width: 20px;
        height: 20px;
    }
    
    .mobile-cta-button {
        width: 100%;
    }
    
    .mobile-language-selector {
        display: flex;
        justify-content: center;
        gap: 12px;
        padding-top: 16px;
        margin-top: 16px;
        border-top: 1px solid rgba(0,0,0,0.05);
    }
    
    .mobile-language-link {
        padding: 8px 16px;
        font-size: 14px;
        text-transform: uppercase;
        background-color: var(--light-bg);
        border-radius: 4px;
        color: #666;
        text-decoration: none;
    }
    
    /* CTA Button (ya existente en index.njk) */
    .cta-button {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 30px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 14px;
    }
    
    .cta-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(32, 72, 230, 0.3);
    }
    
    /* Responsive */
    @media (min-width: 576px) {
        .mobile-cta {
            display: inline-flex;
        }
    }
    
    @media (min-width: 992px) {
        .top-bar {
            display: flex;
        }
        
        .header-content {
            height: 80px;
        }
        
        .desktop-nav {
            display: flex;
        }
        
        .mobile-controls {
            display: none;
        }
    }
</style>